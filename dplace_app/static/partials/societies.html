<div class="container results">
    <div class="row">
        <span>
            <p class="pull-left lead">Societies<span ng-show="results.societies.length">({{ results.societies.length }})</span></p>
        </span>
    </div>
    <tabset>
        <tab heading="Table">
            <div class="row">
                <div ng-hide="results.societies.length">
                    <p class="text-center help-block search-help"></p>
                </div>
                <table class="table" ng-show="results.societies.length">
                    <tr>
                        <th>Name</th>
                        <th>ISO Code</th>
                        <th>Language</th>
                        <th>Trees</th>
                        <th ng-repeat="variable in results.variable_descriptions">{{ variable.name }}</th>
                        <th ng-repeat="environmental in results.environmental_variables">{{ environmental.name }}</th>
                        <th ng-show="results.languages">Language</th>
                        <th ng-show="results.geographic_regions">Geographic Region</th>
                    </tr>
                    <tr ng-repeat="society_result in results.societies">
                        <td><span class="circle" ng-style="society_result.society.style"></span>
                            <a ng-href="/society/{{ society_result.society.id }}" target="_blank">{{ society_result.society.name }}</a>
                        </td>
                        <td>{{ society_result.society.iso_code }}</td>
                        <td>{{ society_result.society.language | formatLanguageName }}</td>
                        <td><a popover="{{society_result.society.trees | formatLanguageTrees }}" title="'Trees'">{{ society_result.society.trees | countOrBlank }}</a></td>
                        <td ng-repeat="variable in results.variable_descriptions">
                            {{ society_result.variable_coded_values | formatVariableCodeValues:variable.id }}
                        </td>
                        <td ng-repeat="environmental in results.environmental_variables">
                            {{ society_result.environmental_values | formatEnvironmentalValues }}
                        </td>
                        <td ng-show="results.languages">
                            {{ society_result.languages | formatLanguage}}
                        </td>
                        <td ng-show="results.geographic_regions">
                            {{ society_result.geographic_regions | formatGeographicRegion}}
                        </td>
                    </tr>
                </table>
            </div>
        </tab>
        <tab heading="Map" select="visible=true" deselect="visible=false">
            <dplace-map societies="results.societies" map-div-id="result-map" visible="visible" query="query"></dplace-map>
        </tab>
        <tab heading="Tree">
            <h4> Phylogenies </h4>
            <select
                ng-model="results.selectedTree"
                class="form-control"
                style="width:100%"
                ng-change="treeSelected()"
                ng-options="tree.name for tree in results.languageTrees"
                >
                <option value="">Select a Phylogeny</option>
            </select>
            <div id="legend" ng-show="results.selectedTree">
                <table ng-repeat="(id, code) in code_ids">
                    <tr><th colspan="2">{{code.CID}}: {{code.name}}</th></tr>
                    <tr ng-repeat="c in code">
                        <td>
                            <svg height="20" width="20">
                                <circle
                                    cx="10"
                                    cy="10"
                                    r="4.5"
                                    fill="{{c.code|colorNode:code}}"
                                    stroke="#000"
                                    stroke-width="0.5"
                                />
                           </svg>
                        </td>
                        <td>{{c.description}}</td>
                    </tr>
                </table>
                <table ng-repeat="environmental in results.environmental_variables">
                    <tr><th>E1: {{environmental.name}}</th></tr>
                </table>
                <table>
                    <tr ng-repeat="class in classifications">
                    <td>
                        <svg height="20" width="20">
                            <circle
                                cx="10"
                                cy="10"
                                r="4.5"
                                fill="{{class.id|colorNode:classifications}}" //need to figure out how to put right length
                                stroke="#000"
                                stroke-width="0.5"
                            />
                        </svg>
                    </td>
                    <td>
                        {{class.name}}
                    </td>
                    </tr>
                </table>
            </div>
            <language-phylogeny></language-phylogeny>
        </tab>
        <tab heading="Download" select="generateDownloadLinks()">
            <div class="row">
                <h4>Download results as:</h4>
                <ul>
                    <li>
                        <a ng-href="{{ csvDownloadLink }}" class="btn btn-info btn-dplace-download">CSV</a>
                    </li>
                </ul>
            </div>
        </tab>
    </tabset>
</div>